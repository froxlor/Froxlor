{% macro fieldrow(id, field, norow = false, nohide = false, em = false) %}
	{% if field.visible is not defined or (field.visible is defined and field.visible) or nohide == true %}
		{% if norow == false and field.type != 'hidden' %}
			<div class="row g-0 formfield d-flex align-items-center">
				{% if field.label is iterable %}
					<label for="{{ id }}" class="col-sm-4 col-form-label pe-3">
						{% if em %}
							<mark>
							{% endif %}
							{{ field.label.title|raw }}
							{% if em %}
							</mark>
						{% endif %}
						{% if field.label.description is defined and field.label.description is not empty %}<br><small>{{ field.label.description|raw }}</small>
						{% endif %}
					</label>
				{% else %}
					<label for="{{ id }}" class="col-sm-4 col-form-label pe-3">
						{% if em %}
							<mark>
							{% endif %}
							{{ field.label|raw }}
							{% if em %}
							</mark>
						{% endif %}
						{% if field.desc is defined and field.desc is not empty %}<br><small>{{ field.desc|raw }}</small>
						{% endif %}
					</label>
				{% endif %}
				<div class="col-sm-8">
				{% endif %}
				{% if field.type == 'text' or field.type == 'password' or field.type == 'number' or field.type == 'file' or field.type == 'email' or field.type == 'url' or field.type == 'hidden' %}
					{{ _self.input(id, field) }}
				{% elseif field.type == 'textul' %}
					{{ _self.input_ul(id, field) }}
				{% elseif field.type == 'checkbox' %}
					{{ _self.bool(id, field) }}
				{% elseif field.type == 'select' %}
					{{ _self.select(id, field) }}
				{% elseif field.type == 'textarea' %}
					{{ _self.textarea(id, field) }}
				{% elseif field.type == 'label' %}
					{{ _self.plain(id, field) }}
				{% elseif field.type == 'link' %}
					{{ _self.link(id, field) }}
				{% elseif field.type == 'itemlist' %}
					{{ _self.itemlist(id, field) }}
				{% elseif field.type == 'infotext' %}
					{{ _self.infotext(id, field) }}
				{% else %}
					<div class="alert alert-warning" role="alert">Unknown field-type
						{{ field.type }}</div>
				{% endif %}
				{% if field.note is defined and field.note is not empty %}
					<small class="text-info">{{ field.note|raw }}</small>
				{% endif %}
				{% if norow == false and field.type != 'hidden' %}
				</div>
			</div>
		{% endif %}
	{% endif %}
{% endmacro %}

{% macro bool(id, field) %}
	{% if field.is_array is defined and field.is_array == 1 and field.values is not empty %}
		{% for subfield in field.values %}
			<div class="form-check form-switch">
				<input type="checkbox" {% if field.visible is defined and field.visible == false %} disabled {% endif %} value="{{ subfield.value }}" name="{{ id }}[]" class="form-check-input" {% if field.value is defined and subfield.value in field.value %} checked="checked" {% endif %}>
				<label class="form-check-label">
					{{ subfield.label|raw }}
				</label>
			</div>
		{% endfor %}
	{% else %}
		<div class="form-check form-switch">
			<input type="hidden" value="0" name="{{ id }}" />
			<input type="checkbox" {% if field.visible is defined and field.visible == false %} disabled {% endif %} value="{{ field.value }}" id="{{ id }}" name="{{ id }}" class="form-check-input {% if field.valid is defined and field.valid == false %}is-invalid{% endif %}" {% if field.checked is defined and field.checked == 1 %} checked="checked" {% endif %}>
		</div>
	{% endif %}
{% endmacro %}

{% macro infotext(id, field) %}
	{% if field.next_to is defined %}
		<div class="input-group">
		{% endif %}
		<span {% if field.classes is defined %} class="{{ field.classes }}" {% endif %}>{{ field.value|raw }}</span>
		{% if field.next_to is defined %}
			{% for nid, nfield in field.next_to %}
				{% if nfield.next_to_prefix is defined %}
					<span class="input-group-text">{{ nfield.next_to_prefix }}</span>
				{% endif %}
				{{ _self.fieldrow(nid, nfield, true) }}
			{% endfor %}
		</div>
	{% endif %}
{% endmacro %}

{% macro plain(id, field) %}
	{% if field.next_to is defined %}
		<div class="input-group">
		{% endif %}
		<input type="text" readonly class="form-control-plaintext" id="{{ id }}" name="{{ id }}" value="{{ field.value }}">
		{% if field.next_to is defined %}
			{% for nid, nfield in field.next_to %}
				{% if nfield.next_to_prefix is defined %}
					<span class="input-group-text">{{ nfield.next_to_prefix }}</span>
				{% endif %}
				{{ _self.fieldrow(nid, nfield, true) }}
			{% endfor %}
		</div>
	{% endif %}
{% endmacro %}

{% macro input(id, field) %}
	{% if field.next_to is defined %}
		<div class="input-group">
		{% endif %}
		<input type="{{ field.type }}" {% if field.visible is defined and field.visible == false %} disabled {% endif %} {% if field.type == 'number' and field.min is defined %} min="{{ field.min }}" {% endif %} {% if field.type == 'number' and field.max is defined %} max="{{ field.max }}" {% endif %} {% if field.type != 'number' and field.maxlength is defined %} maxlength="{{ field.maxlength }}" {% endif %} id="{{ id }}" name="{{ id }}" value="{{ field.value }}" class="form-control {% if field.valid is defined and field.valid == false %}is-invalid{% endif %}" {% if field.mandatory is defined and field.mandatory %} required {% endif %} {% if field.readonly is defined and field.readonly %} readonly {% endif %} {% if field.autocomplete is defined %} autocomplete="{{ field.autocomplete }}" {% endif %} {% if field.placeholder is defined %} placeholder="{{ field.placeholder }}" {% endif %}/>
		{% if field.type == 'hidden' and field.display is defined %}
			<input type="text" readonly class="form-control-plaintext" value="{{ field.display }}">
		{% endif %}
		{% if field.note is defined and field.note is not empty %}
			<div class="invalid-feedback">{{ field.note|raw }}</div>
		{% endif %}
		{% if field.next_to is defined %}
			{% for nid, nfield in field.next_to %}
				{% if nfield.next_to_prefix is defined %}
					<span class="input-group-text">{{ nfield.next_to_prefix }}</span>
				{% endif %}
				{{ _self.fieldrow(nid, nfield, true) }}
			{% endfor %}
		</div>
	{% endif %}
{% endmacro %}

{% macro input_ul(id, field) %}
	{% set max = "" %}
	{% if field.maxlength is defined %}
		{% for i in 1..field.maxlength %}
			{% set max = max ~ "9" %}
		{% endfor %}
	{% endif %}
	<div class="input-group">
		<input type="number" min="0" {% if max is not empty %} max="{{ max }}" {% endif %} id="{{ id }}" name="{{ id }}" value="{% if field.value >= 0 %}{{ field.value }}{% endif %}" class="form-control {% if field.valid is defined and field.valid == false %}is-invalid{% endif %}" {% if field.mandatory is defined and field.mandatory %} required {% endif %} {% if field.readonly is defined and field.readonly %} readonly {% endif %} {% if field.autocomplete is defined %} autocomplete="{{ field.autocomplete }}" {% endif %} {% if field.placeholder is defined %} placeholder="{{ field.placeholder }}" {% endif %}/>
		<div class="input-group-text">
			<input class="form-check-input mt-0" type="checkbox" name="{{ id }}_ul" value="1" {% if field.value == -1 %} checked="checked" {% endif %}>
		</div>
	</div>
{% endmacro %}


{% macro select(id, field) %}
	{% if field.next_to is defined %}
		<div class="input-group">
		{% endif %}
		<select {% if field.visible is defined and field.visible == false %} disabled {% endif %} class="form-select {% if field.valid is defined and field.valid == false %}is-invalid{% endif %}" name="{{ id }}{% if field.select_mode is defined and field.select_mode == 'multiple' %}[]{% endif %}" id="{{ id }}" {% if field.mandatory is defined and field.mandatory %} required {% endif %} {% if field.select_mode is defined and field.select_mode == 'multiple' %} multiple="multiple" {% endif %}>
			{% for val,txt in field.select_var %}
				<option value="{{ val }}" {% if field.selected is defined and ((field.selected is not iterable and field.selected == val) or (field.selected is iterable and val in field.selected|keys)) %} selected="selected" {% endif %}>{{ txt|raw }}</option>
			{% endfor %}
		</select>
		{% if field.next_to is defined %}
			{% for nid, nfield in field.next_to %}
				{% if nfield.next_to_prefix is defined %}
					<span class="input-group-text">{{ nfield.next_to_prefix }}</span>
				{% endif %}
				{{ _self.fieldrow(nid, nfield, true) }}
			{% endfor %}
		</div>
	{% endif %}
{% endmacro %}

{% macro textarea(id, field) %}
	<textarea {% if field.visible is defined and field.visible == false %} disabled {% endif %} rows="{{ field.rows|default('12') }}" cols="{{ field.cols|default('60') }}" id="{{ id }}" name="{{ id }}" class="form-control {% if field.valid is defined and field.valid == false %}is-invalid{% endif %}" {% if field.mandatory is defined and field.mandatory %} required {% endif %} {% if field.readonly is defined and field.readonly %} readonly {% endif %} {% if field.placeholder is defined %} placeholder="{{ field.placeholder }}" {% endif %}>{{ field.value }}</textarea>
{% endmacro %}

{% macro link(id, field) %}
	<a href="{{ field.href|raw }}" class="{{ field.classes }}">{{ field.label|raw }}</a>
{% endmacro %}

{% macro itemlist(id, field) %}
	{% if field.values is not empty %}
		{% for value in field.values %}
			<p>{{ value.item|raw }}
				{% if value.href is defined and value.href is not empty %}
					{{ _self.link(id, value) }}
				{% endif %}
			</p>
		{% endfor %}
	{% endif %}
	{% if field.next_to is defined %}
		{% for nid, nfield in field.next_to %}
			{{ _self.fieldrow(nid, nfield, true) }}
		{% endfor %}
	{% endif %}
{% endmacro %}
